<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Modal Alert Dialog Blueprint</title>
    <style>
      #overlay {
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, .4);
        padding-top: 60px;
      }

      #alertDialog {
        background-color: #fefefe;
        margin: 5% auto 15% auto;
        border: 1px solid #888;
        width: 65%;
        padding: 5px;
      }
    </style>
    <script>
      /** @type {!Element} The alert dialog. */
      let alertDialogEl;

      /** @type {!Element} the first interactive element in the dialog. */
      let googleLinkEl;

      /** @type {!Element} The button to close the alert dialog. */
      let okayButtonEl;

      /** @type {!Element} The button to open the alert dialog. */
      let openAlertDialogButtonEl;

      /**
       * @type {!Element} The overlay obscuring the content of the page behind
       *     the dialog.
       */
      let overlayEl;

      function init() {
        openAlertDialogButtonEl =
            document.getElementById('openAlertDialogButton');
        okayButtonEl = document.getElementById('okayButton');
        googleLinkEl = document.getElementById('googleLink');
        alertDialogEl = document.getElementById('alertDialog');
        overlayEl = document.getElementById('overlay');
        setEventListeners();
      }

      /**
       * Sets up event listeners to manage focus within the dialog and prevent
       * users from interacting with content behind the dialog.
       */
      function setEventListeners() {
        openAlertDialogButtonEl.addEventListener('click', openDialog, false);
        okayButtonEl.addEventListener('click', closeDialog, false);
        overlayEl.addEventListener('click', handleOverlayClick, false);
        trapFocusInDialog();
      }

      /**
       * Open the alert dialog, obscure the content behind it, and add an event
       * listener to close the dialog on Escape.
       */
      function openDialog() {
        overlayEl.removeAttribute('hidden');
        okayButtonEl.focus();
        document.addEventListener('keyup', handleDocumentKeyup, false);
      }

      /**
       * Close the alert dialog, unobscure the content behind it, and remove
       * the Escape event listener.
       */
      function closeDialog() {
        overlayEl.setAttribute('hidden', '');
        openAlertDialogButtonEl.focus();
        document.removeEventListener('keyup', handleDocumentKeyup);
      }

      /**
       * Handle clicks on the overlay to prevent click events behind the dialog.
       * @param {!Event} e
       */
      function handleOverlayClick(e) {
        if (!alertDialogEl.contains(e.target)) {
          e.preventDefault();
        }
      }

      /**
       * Handle the Escape key by closing the dialog.
       * @param {!Event} e
       */
      function handleDocumentKeyup(e) {
        if (e.key === 'Escape' ||
            e.key === 'Esc') { // Edge
          closeDialog();
        }
      }

      /**
       * Set up event listeners to trap focus within the dialog. Tabbing on the
       * last interactive element applies focus to the first interactive
       * element; shift-tabbing from the last interactive element applies focus
       * to the first interactive element.
       */
      function trapFocusInDialog() {
        googleLinkEl.addEventListener(
            'keydown', handleFirstInteractiveElementTab, false);
        okayButtonEl.addEventListener(
            'keydown', handleLastInteractiveElementTab, false);
      }

      /**
       * Handle tab on the last interactive element within the dialog
       * @param {!Event} e
       */
      function handleLastInteractiveElementTab(e) {
        if (e.key === 'Tab' && !e.shiftKey) {
          e.preventDefault();
          // focus on first interactive element in the dialog.
          googleLinkEl.focus();
        }
      }

      /**
       * Handle shift+tab on the first interactive element within the dialog.
       * @param {!Event} e
       */
      function handleFirstInteractiveElementTab(e) {
        if (e.key === 'Tab' && e.shiftKey) {
          e.preventDefault();
          // focus on the last interactive element in the dialog.
          okayButtonEl.focus();
        }
      }

      window.addEventListener('load', init, false);
    </script>
  </head>

  <body>
    <main>
      <button id="openAlertDialogButton">Open alert dialog</button>
    </main>
    <div id="overlay" role="presentation" hidden>
      <div id="alertDialog" role="alertdialog" aria-modal="true"
          aria-labelledby="alertDialogHeading"
          aria-describedby="alertDialogMessage">
        <h2 id="alertDialogHeading">Error!</h2>
        <p id="alertDialogMessage">
          Oops!

          To fix the issue. Visit <a id="googleLink" target="_blank"
          href="http://google.com">Google.com</a> and click around.
        </p>
        <button id="okayButton">Okay</button>
      </div>
    </div>
  </body>
</html>
